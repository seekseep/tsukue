<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
		<title>Hammer.js</title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
		<script src="http://hammerjs.github.io/dist/hammer.min.js"></script>
		<script src="js/jquery.hammer.js"></script>
		<style>
			html,body {
				height:100%;
				margin:0;
			}
			.card {
				background-image:url(img/card.png);
				/*position:absolute;*/
				width:200px;
				height:300px;
			}
			.back {
				background-position:-400px -1200px !important;
			}
			#card1 {
				background-position:-200px;
			}
			#card2 {
				background-position:-400px;
			}
			#card3 {
				background-position:-600px;
			}
			#container {
				-webkit-transform-origin:left top;
				transform-origin:left top;
				width:2600px;
				height:1500px;
			}
			#ctrls {
				margin:2em 0;
				position:fixed;
				width:100%;
				z-index:100;
			}
			#slider {
				display:block;
				margin:0 auto;
				width:90%;
			}
			#menu {
				background-color:Silver;
				border-radius:10px;
				box-shadow:0 0 10px black;
				position:fixed;
				width:100px;
				height:100px;
				display:none;
				z-index:100;
			}
			body {
				overflow:hidden;
			}
		</style>
		<script>
			$(function(){
				var point=[];
				var tmp={};
				var index=0;
				var zoom=1;
				Hammer.defaults.preset[4][1]={time:1000,threshold:10};
				$("#slider").on("input",function(){
					zoom=this.value;
					$("#container").css("transform","scale("+zoom+")");
				});
				var elem=$("body").hammer({
					recognizers:[
						[Hammer.Pan,{direction:Hammer.DIRECTION_ALL}]
					]
				});
				elem.on("panstart",function(){
					tmp=$("#container").offset();
				});
				elem.on("panmove",function(ev){
					var obj={
						top:tmp.top+ev.gesture.deltaY,
						left:tmp.left+ev.gesture.deltaX
					}
					if(obj.top>0){
						obj.top=0;
					}
					if(obj.left>0){
						obj.left=0;
					}
					$("#container").offset(obj);
				});
				/*elem.on("panend",function(ev){
					var end=ev.gesture.velocityY*400;
					if($("#container").offset().top-end>0){
						$("#container").animate({top:"0px"},"fast","linear");
					}else{
						$("#container").animate({top:"-="+end},"fast","linear");
					}
					$("#card1").html(end);
				});
				$("body").hammer({
					recognizers:[
						[Hammer.Pinch,{enable:true}]
					],
					touchAction:"manipulation"
				});
				$(".card").hammer({
					recognizers:[
						[Hammer.Tap,{time:1000,threshold:10}],
						[Hammer.Pan,{direction:Hammer.DIRECTION_ALL}],
						[Hammer.Rotate,{enable:true}]
					]
				});*/
				$(".card").on("touchstart",function(e){
					e.preventDefault();
				});
				$(".card").hammer().on("panstart rotatestart",function(){
					if(!tmp.name){
						var n=this.id.charAt(4)-0;
						point[n]=point[n]||{};
						tmp.x=point[n].x||0;
						tmp.y=point[n].y||0;
						tmp.deg=point[n].deg||0;
						tmp.name=this.id;
						$(this).css("z-index",++index);
					}
				});
				$(".card").data("hammer").get("rotate").set({enable:true});
				$(".card").data("hammer").get("pan").set({direction:Hammer.DIRECTION_ALL});
				$(".card").hammer().on("panmove rotatemove",function(ev){
					//$("#box").offset({left:point.left+ev.gesture.deltaX,top:point.top+ev.gesture.deltaY});
					if(tmp.name==this.id){
						var n=this.id.charAt(4)-0;
						point[n].x=tmp.x+ev.gesture.deltaX/zoom;
						point[n].y=tmp.y+ev.gesture.deltaY/zoom;
						point[n].deg=tmp.deg+ev.gesture.rotation;
						if(point[n].x<0){
							point[n].x=0;
						}/*else if(point[n].x>$("body").width()-$(this).width()){
							point[n].x=$("body").width()-$(this).width();
						}*/
						if(point[n].y<0){
							point[n].y=0;
						}/*else if(point[n].y>$("body").height()-$(this).height()){
							point[n].y=$("body").height()-$(this).height();
						}*/
						$(this).css("transform","translate3d("+point[n].x+"px,"+point[n].y+"px,0) rotate3d(0,0,1,"+point[n].deg+"deg)");
					}
				});
				$(".card").hammer().on("panend pancancel rotateend rotatecancel",function(){
					if(tmp.name==this.id){
						tmp.name=null;
					}
				});
				/*$(".card").hammer().on("tap",function(){
					$(this).toggleClass("back");
					$(this).css("z-index",++index);
				});*/
				$(".card").hammer().on("press",function(ev){
					$("#menu").html(this.id);
					$("#menu").css("transform","translate3d("+ev.gesture.center.x+"px,"+ev.gesture.center.y+"px,0)");
					$("#menu").show();
				});
				document.body.addEventListener("touchstart",function(e){
					e.preventDefault();
					$("#menu").hide();
				});
				$("#menu").click(function(){
					alert($(this).html());
				});
			});
		</script>
	</head>
	<body>
		<div id="ctrls">
			<input type="range" id="slider" min="0.5" max="1" step="0.01" value="1">
		</div>
		<div id="menu"></div>
		<div id="container">
			<div class="card" id="card0"></div>
			<div class="card" id="card1"></div>
			<!--<div class="card" id="card2"></div>
			<div class="card" id="card3"></div>-->
		</div>
	</body>
</html>